<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explorer Supabase | Neon Edition</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg-dark: #0b0e16;
  --bg-card: #141829;
  --accent: #00ffc3;
  --accent2: #7a5cff;
  --text: #f5f5f5;
  --border: rgba(255,255,255,0.08);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Poppins", sans-serif;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: linear-gradient(145deg, #090d16, #101628);
  color: var(--text);
}

/* HEADER */
.header {
  height: 55px;
  background: var(--bg-card);
  color: var(--accent);
  display: flex;
  align-items: center;
  padding: 0 20px;
  font-size: 1.2em;
  font-weight: 600;
  box-shadow: 0 0 15px rgba(0, 255, 195, 0.2);
  border-bottom: 1px solid var(--border);
  text-shadow: 0 0 8px rgba(0,255,195,0.4);
}

/* AREA UTAMA */
.file-explorer {
  display: flex;
  flex-grow: 1;
  overflow: hidden;
}

/* SIDEBAR */
.sidebar {
  width: 320px;
  background: var(--bg-card);
  border-right: 1px solid var(--border);
  padding: 15px;
  overflow-y: auto;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
}
.sidebar h2 {
  margin-bottom: 15px;
  font-size: 1.1em;
  font-weight: 600;
  color: var(--accent2);
  text-shadow: 0 0 8px rgba(122,92,255,0.4);
  border-bottom: 1px solid var(--border);
  padding-bottom: 8px;
}

.folder-list { list-style: none; padding-left: 10px; transition: all 0.3s; }
.folder-item {
  cursor: pointer;
  padding: 5px 8px;
  border-radius: 6px;
  transition: 0.3s;
}
.folder-item:hover {
  background: rgba(255,255,255,0.05);
}
.folder-item.selected {
  background: var(--accent);
  color: var(--bg-dark);
  font-weight: 600;
  box-shadow: 0 0 10px rgba(0,255,195,0.4);
}

.folder-item span { margin-left: 6px; }

.file-item {
  padding: 4px 12px;
  margin-left: 25px;
  cursor: pointer;
  opacity: 0.85;
}
.file-item:hover { color: var(--accent2); }

.toggle {
  margin-right: 5px;
  color: var(--accent);
  cursor: pointer;
  user-select: none;
}

.hidden { display: none; }

.content-panel {
  flex-grow: 1;
  padding: 20px;
  background: var(--bg-dark);
  overflow-y: auto;
}
.content-panel h3 {
  color: var(--accent);
  text-shadow: 0 0 8px rgba(0,255,195,0.4);
}
.file-content {
  background: var(--bg-card);
  color: var(--text);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid var(--border);
  min-height: 300px;
  font-family: "Consolas", monospace;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
  white-space: pre-wrap;
}
.save-area {
  margin-top: 15px;
  display: flex;
  gap: 10px;
  align-items: center;
}
.save-area button {
  background: var(--accent2);
  color: var(--bg-card);
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 0 12px rgba(122,92,255,0.3);
  transition: 0.3s;
}
.save-area button:hover {
  background: #9270ff;
  box-shadow: 0 0 20px rgba(122,92,255,0.4);
}
#save-status { color: var(--accent); font-weight: 500; }

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-thumb { background: var(--accent2); border-radius: 4px; }
</style>
</head>
<body>

<div class="header">‚òÅÔ∏è Supabase Explorer Neon</div>

<div class="file-explorer">
  <div class="sidebar">
    <h2>üóÇÔ∏è Struktur Folder</h2>
    <ul class="folder-list" id="folderTree">Memuat data...</ul>
  </div>

  <div class="content-panel">
    <h3 id="content-title">Pilih File</h3>
    <p>Tipe: <span id="content-type"></span></p>
    <div class="file-content" id="file-editor" contenteditable="false">(Isi file akan tampil di sini)</div>
    <div class="save-area">
      <button onclick="saveFileContent()">üíæ Simpan</button>
      <span id="save-status"></span>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://zawtfjszvkuudawrilqg.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inphd3RmanN6dmt1dWRhd3JpbHFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MTk2NzMsImV4cCI6MjA3NDk5NTY3M30.CGYz4-QnYb3Hu9p3fV0XoG5J8oicqZsji-YJf2UItQ8';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let selectedFileId = null;

// üîπ Load root folder
async function loadRootFolders() {
  const list = document.getElementById('folderTree');
  list.innerHTML = 'Memuat...';
  const { data, error } = await supabase.from('folder_items').select('*').is('parent_id', null).eq('type', 'folder');
  if (error) return list.innerHTML = 'Gagal memuat data.';
  list.innerHTML = '';
  data.forEach(folder => list.appendChild(createFolder(folder)));
}

// üîπ Folder element
function createFolder(folder) {
  const li = document.createElement('li');
  li.innerHTML = `
    <div class="folder-item" onclick="toggleFolder(this,'${folder.id}')">
      <span class="toggle">‚ñ∂</span>üìÅ ${folder.name}
    </div>
    <ul class="folder-list hidden"></ul>
  `;
  return li;
}

// üîπ Toggle folder open/close
async function toggleFolder(el, id) {
  const ul = el.nextElementSibling;
  const icon = el.querySelector('.toggle');

  // jika sedang terbuka ‚Üí tutup
  if (!ul.classList.contains('hidden')) {
    ul.classList.add('hidden');
    icon.textContent = '‚ñ∂';
    return;
  }

  // jika belum pernah dimuat, ambil data dari Supabase
  if (!ul.dataset.loaded) {
    ul.innerHTML = '<li style="opacity:0.6;">Memuat...</li>';
    const { data, error } = await supabase.from('folder_items').select('*').eq('parent_id', id);
    if (error) {
      ul.innerHTML = '<li style="color:red;">Gagal memuat isi</li>';
      return;
    }
    ul.innerHTML = '';
    if (data.length === 0) {
      ul.innerHTML = '<li style="opacity:0.6;">(Kosong)</li>';
    } else {
      data.forEach(item => {
        if (item.type === 'folder') ul.appendChild(createFolder(item));
        else ul.appendChild(createFile(item));
      });
    }
    ul.dataset.loaded = 'true';
  }

  // tampilkan isi (expand)
  ul.classList.remove('hidden');
  icon.textContent = '‚ñº';
}

// üîπ File element
function createFile(file) {
  const li = document.createElement('li');
  li.className = 'file-item';
  li.textContent = `üìÑ ${file.name}`;
  li.onclick = () => openFile(file);
  return li;
}

// üîπ Buka file ke kanan
async function openFile(file) {
  document.getElementById('content-title').textContent = `File: ${file.name}`;
  document.getElementById('content-type').textContent = 'File';
  const editor = document.getElementById('file-editor');
  editor.textContent = 'Memuat...';
  const { data, error } = await supabase.from('folder_items').select('content').eq('id', file.id).single();
  editor.textContent = data?.content || '(Kosong)';
  selectedFileId = file.id;
}

// üîπ Simpan isi file
async function saveFileContent() {
  const editor = document.getElementById('file-editor');
  const status = document.getElementById('save-status');
  if (!selectedFileId) return alert('Pilih file dulu.');
  status.textContent = 'Menyimpan...';
  const { error } = await supabase.from('folder_items').update({ content: editor.textContent }).eq('id', selectedFileId);
  status.textContent = error ? '‚ùå Gagal' : '‚úÖ Tersimpan';
  setTimeout(() => status.textContent = '', 2000);
}

document.addEventListener('DOMContentLoaded', loadRootFolders);
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explorer Supabase | Neon Edition</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg-dark: #0b0e16;
  --bg-card: #141829;
  --accent: #00ffc3;
  --accent2: #7a5cff;
  --text: #f5f5f5;
  --subtext: #b0b0b0;
  --border: rgba(255,255,255,0.08);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Poppins", sans-serif;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: linear-gradient(145deg, #090d16, #101628);
  color: var(--text);
}

/* HEADER */
.header {
  height: 55px;
  background: var(--bg-card);
  color: var(--accent);
  display: flex;
  align-items: center;
  padding: 0 20px;
  font-size: 1.2em;
  font-weight: 600;
  box-shadow: 0 0 15px rgba(0, 255, 195, 0.2);
  border-bottom: 1px solid var(--border);
  text-shadow: 0 0 8px rgba(0,255,195,0.4);
}

/* AREA UTAMA */
.file-explorer {
  display: flex;
  flex-grow: 1;
  overflow: hidden;
}

/* SIDEBAR */
.sidebar {
  width: 280px;
  background: var(--bg-card);
  border-right: 1px solid var(--border);
  padding: 15px;
  overflow-y: auto;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
}
.sidebar h2 {
  margin-bottom: 15px;
  font-size: 1.1em;
  font-weight: 600;
  color: var(--accent2);
  text-shadow: 0 0 8px rgba(122,92,255,0.4);
  border-bottom: 1px solid var(--border);
  padding-bottom: 8px;
}

/* TOMBOL */
.action-bar {
  margin-bottom: 15px;
  display: flex;
  gap: 8px;
}
.action-bar button {
  background: var(--accent);
  color: var(--bg-card);
  border: none;
  padding: 7px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: 0.3s;
  box-shadow: 0 0 10px rgba(0,255,195,0.2);
}
.action-bar button:hover {
  background: #00e6a3;
  box-shadow: 0 0 20px rgba(0,255,195,0.3);
}

/* POHON FILE */
.folder-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.folder-list li {
  margin: 2px 0;
  position: relative;
}
.item-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 8px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s;
}
.folder-list li:hover > .item-header {
  background: rgba(255,255,255,0.05);
}
.folder-list li.selected > .item-header {
  background: var(--accent);
  color: var(--bg-card);
  font-weight: 600;
  box-shadow: 0 0 10px rgba(0,255,195,0.4);
}

.item-header::before {
  content: "üìÅ";
  margin-right: 6px;
  font-size: 1em;
}
.folder-list li.file > .item-header::before {
  content: "üìÑ";
  opacity: 0.7;
}

/* DROPDOWN */
.controls { opacity: 0; transition: opacity 0.3s; }
.folder-list li:hover > .item-header .controls { opacity: 1; }
.ellipsis-button {
  background: none;
  border: none;
  color: var(--accent2);
  cursor: pointer;
  font-weight: bold;
  padding: 3px 6px;
  border-radius: 4px;
}
.ellipsis-button:hover {
  background: rgba(122,92,255,0.1);
  color: var(--accent);
}
.dropdown-menu {
  position: absolute;
  right: 10px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
  padding: 6px 0;
  display: none;
  z-index: 100;
}
.dropdown-menu.visible { display: block; }
.dropdown-menu button {
  background: none;
  border: none;
  color: var(--text);
  width: 100%;
  text-align: left;
  padding: 8px 14px;
  cursor: pointer;
}
.dropdown-menu button:hover {
  background: rgba(0,255,195,0.15);
  color: var(--accent);
}

/* AREA KONTEN */
.content-panel {
  flex-grow: 1;
  padding: 20px;
  background: var(--bg-dark);
  overflow-y: auto;
}
.content-panel h3 {
  color: var(--accent);
  text-shadow: 0 0 8px rgba(0,255,195,0.4);
}
.file-content {
  background: var(--bg-card);
  color: var(--text);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid var(--border);
  min-height: 300px;
  font-family: "Consolas", monospace;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
  white-space: pre-wrap;
}
.save-area {
  margin-top: 15px;
  display: flex;
  gap: 10px;
  align-items: center;
}
.save-area button {
  background: var(--accent2);
  color: var(--bg-card);
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 0 12px rgba(122,92,255,0.3);
  transition: 0.3s;
}
.save-area button:hover {
  background: #9270ff;
  box-shadow: 0 0 20px rgba(122,92,255,0.4);
}
#save-status { color: var(--accent); font-weight: 500; }

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-thumb {
  background: var(--accent2);
  border-radius: 4px;
}
</style>
</head>
<body>

<div class="header">‚òÅÔ∏è Supabase Explorer Neon</div>

<div class="file-explorer">
  <div class="sidebar">
    <h2>üóÇÔ∏è Struktur Direktori</h2>
    <div class="action-bar">
      <button onclick="addNewItem(null,'folder')">‚ûï Folder</button>
      <button onclick="addNewItem(null,'file')">‚ûï File</button>
    </div>
    <ul class="folder-list" id="root-list">
      <li style="text-align:center;">Memuat data...</li>
    </ul>
  </div>

  <div class="content-panel">
    <h3 id="content-title">Pilih File untuk Melihat Konten</h3>
    <p>Tipe: <span id="content-type"></span></p>
    <div class="file-content" id="file-editor" contenteditable="false">
      Silakan tunggu hingga data dimuat...
    </div>
    <div class="save-area">
      <button onclick="saveFileContent()">üíæ Simpan Perubahan</button>
      <span id="save-status"></span>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://zawtfjszvkuudawrilqg.supabase.co'; 
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inphd3RmanN6dmt1dWRhd3JpbHFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MTk2NzMsImV4cCI6MjA3NDk5NTY3M30.CGYz4-QnYb3Hu9p3fV0XoG5J8oicqZsji-YJf2UItQ8';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let itemCounter=1, selectedItemId=null;

function buildTree(items){const root=[];const map={};items.forEach(i=>map[i.id]={...i,children:[]});Object.values(map).forEach(i=>{if(!i.parent_id)root.push(i);else if(map[i.parent_id])map[i.parent_id].children.push(i);});return root;}
function createItemElement(d){const id=`item-${d.id}`,li=document.createElement('li');li.className=d.type;li.id=id;
const folder=d.type==='folder';const inner=folder?`<span class="toggle-icon"></span>${d.name}`:d.name;
const folderActions=folder?`<button onclick="addNewItem('${id}','folder');toggleMenu('${id}');">+ Folder</button><button onclick="addNewItem('${id}','file');toggleMenu('${id}');">+ File</button><hr style='border:none;border-top:1px solid var(--border);margin:5px 0;'>`:'';
li.innerHTML=`<div class='item-header' onclick="selectItem('${id}')"><span class='item-name'>${inner}</span><div class='controls' id='controls-${id}'><button class='ellipsis-button' onclick="event.stopPropagation();toggleMenu('${id}')">‚Ä¢‚Ä¢‚Ä¢</button><div class='dropdown-menu' id='menu-${id}'>${folderActions}<button onclick="editItemName('${id}');toggleMenu('${id}');">‚úèÔ∏è Edit</button><button onclick="deleteItem('${id}');toggleMenu('${id}');" style="color:#ff5555;">üóëÔ∏è Hapus</button></div></div></div>${folder?'<ul class="folder-list"></ul>':''}`;
return li;}

function renderTree(items,ul){items.forEach(i=>{const li=createItemElement(i);ul.appendChild(li);if(i.type==='folder'&&i.children.length){const newUl=document.createElement('ul');newUl.className='folder-list';li.appendChild(newUl);i.children.sort((a,b)=>(b.type==='folder')-(a.type==='folder')||a.name.localeCompare(b.name));renderTree(i.children,newUl);}});}
window.toggleMenu=function(id){const menu=document.getElementById(`menu-${id}`);const controls=document.getElementById(`controls-${id}`);document.querySelectorAll('.dropdown-menu.visible').forEach(m=>{if(m.id!==`menu-${id}`){m.classList.remove('visible');m.parentNode.classList.remove('active');}});menu.classList.toggle('visible');controls.classList.toggle('active');}
document.addEventListener('click',e=>{if(!e.target.closest('.dropdown-menu,.ellipsis-button'))document.querySelectorAll('.dropdown-menu.visible').forEach(m=>m.classList.remove('visible'));});
window.fetchAndRenderItems=async()=>{const root=document.getElementById('root-list');root.innerHTML='<li style="text-align:center;">Memuat...</li>';const {data,error}=await supabase.from('folder_items').select('*');if(error){root.innerHTML='<li style="color:red;">Gagal memuat data.</li>';return;}root.innerHTML='';const tree=buildTree(data);tree.sort((a,b)=>(b.type==='folder')-(a.type==='folder')||a.name.localeCompare(b.name));renderTree(tree,root);}
window.addNewItem=async(parentId,type)=>{const counter=itemCounter++;const name=type==='folder'?`Folder Baru ${counter}`:`file_baru_${counter}.txt`;const parentUUID=parentId?parentId.replace('item-',''):null;const initialContent=type==='file'?'Tulis konten di sini.':null;
const {data,error}=await supabase.from('folder_items').insert({name,type,parent_id:parentUUID,content:initialContent}).select();if(error){alert("Gagal menyimpan!");return;}
const newItem=data[0];if(parentId){const parent=document.getElementById(parentId);let ul=parent.querySelector('.folder-list');if(!ul){ul=document.createElement('ul');ul.className='folder-list';parent.appendChild(ul);}ul.appendChild(createItemElement(newItem));parent.classList.add('expanded');}else document.getElementById('root-list').appendChild(createItemElement(newItem));}
window.editItemName=function(id){const li=document.getElementById(id);const nameSpan=li.querySelector('.item-name');const header=li.querySelector('.item-header');const old=nameSpan.textContent.trim();const input=document.createElement('input');input.className='item-edit-input';input.value=old;input.style.flexGrow='1';nameSpan.style.display='none';header.insertBefore(input,nameSpan);input.focus();const save=async(v)=>{if(v&&v.trim()!==old){const itemUUID=id.replace('item-','');await supabase.from('folder_items').update({name:v}).eq('id',itemUUID);}nameSpan.textContent=v||old;input.remove();nameSpan.style.display='block';};input.onblur=()=>save(input.value);input.onkeyup=e=>{if(e.key==='Enter')input.blur();if(e.key==='Escape')save(old);}}
window.deleteItem=async(id)=>{if(!confirm('Yakin hapus item ini?'))return;const itemUUID=id.replace('item-','');await supabase.from('folder_items').delete().eq('id',itemUUID);const el=document.getElementById(id);if(el)el.remove();}
window.selectItem=async(id)=>{const li=document.getElementById(id);const isFolder=li.classList.contains('folder');const itemUUID=id.replace('item-','');document.querySelectorAll('.folder-list li').forEach(el=>el.classList.remove('selected'));li.classList.add('selected');selectedItemId=itemUUID;document.getElementById('content-type').textContent=isFolder?'Folder':'File';const editor=document.getElementById('file-editor');if(!isFolder){editor.textContent='Memuat konten...';const {data,error}=await supabase.from('folder_items').select('content').eq('id',itemUUID).single();editor.textContent=data?.content||'';}else editor.textContent='(Folder ini tidak memiliki konten yang bisa diedit.)';}
window.saveFileContent=async()=>{const selected=document.querySelector('.folder-list li.selected');const editor=document.getElementById('file-editor');const status=document.getElementById('save-status');if(!selected||selected.classList.contains('folder'))return alert("Pilih file dahulu.");status.textContent='Menyimpan...';const {error}=await supabase.from('folder_items').update({content:editor.textContent}).eq('id',selectedItemId);status.textContent=error?'Gagal!':'Tersimpan!';setTimeout(()=>status.textContent='',2000);}
document.addEventListener('DOMContentLoaded',fetchAndRenderItems);
</script>

</body>
</html>
